import{c as o,l as n,s,a as u,u as i}from"./index-DNuYhCE-.js";import"./react-vendor-Dazix4UH.js";const d=5;async function g(e){try{console.log(`[Recalculation] Starting recalculation for bucket: ${e.name}`);const a=await u(e.funds),c={...e,performance:{...e.performance,rollingReturns:a.rollingReturns,analysisStartDate:a.analysisStartDate,analysisEndDate:a.analysisEndDate,totalPeriods:a.totalPeriods},lastCalculationDate:new Date().toISOString(),updatedAt:new Date().toISOString()};return await i(e.id,c),console.log(`[Recalculation] Successfully recalculated bucket: ${e.name}`),c}catch(a){return console.error(`[Recalculation] Error recalculating bucket ${e.name}:`,a.message),null}}async function R(){const e={checked:0,recalculated:0,skipped:0,errors:0};try{const a=await o();if(!a.isHealthy)return console.log("[Recalculation] Server is not healthy, skipping recalculation"),e;if(a.isLoading)return console.log("[Recalculation] Server is under load, skipping recalculation"),e;console.log("[Recalculation] Server is healthy, checking buckets...");const l=(await n(!1)).filter(t=>(e.checked++,t.isActive&&s(t.lastCalculationDate,d)));if(l.length===0)return console.log("[Recalculation] No buckets need recalculation"),e;console.log(`[Recalculation] Found ${l.length} buckets that need recalculation`);for(const t of l)await g(t)?e.recalculated++:e.errors++,await new Promise(r=>setTimeout(r,1e3));return console.log(`[Recalculation] Completed: ${e.recalculated} recalculated, ${e.errors} errors`),e}catch(a){return console.error("[Recalculation] Error in checkAndRecalculateBuckets:",a.message),e}}export{R as checkAndRecalculateBuckets};
